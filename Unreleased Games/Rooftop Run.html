<!--?xml version="1.0" encoding="UTF-8" ?-->
<html lang="en-us">
<head></head>
<body class="dark">
  <module>
    <moduleprefs title="-">
      <content type="html"><!--[CDATA[
<!DOCTYPE html-->
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/z799gs/99@main/TemplateData/style.css">
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }

          body {
            background: #0a0a1a;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          }

          #unity-container {
            position: relative;
            width: 100%;
            height: 100vh;
          }

          #unity-canvas {
            width: 100%;
            height: 100%;
            background: #0a0a1a;
          }

          /* ==================== LOADING SCREEN ==================== */
          #custom-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 50%, #0a1628 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.8s ease;
          }

          #custom-loading.fade-out {
            opacity: 0;
            pointer-events: none;
          }

          .loading-icon {
            font-size: 56px;
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
          }

          @keyframes pulse {

            0%,
            100% {
              transform: scale(1);
              opacity: 1;
            }

            50% {
              transform: scale(1.15);
              opacity: 0.8;
            }
          }

          .loading-title {
            font-size: 36px;
            font-weight: 900;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.4), 0 4px 8px rgba(0, 0, 0, 0.5);
            margin-bottom: 8px;
            letter-spacing: 4px;
          }

          .loading-subtitle {
            font-size: 13px;
            color: #6080a0;
            margin-bottom: 35px;
            letter-spacing: 1px;
          }

          .progress-container {
            width: 380px;
            margin-bottom: 12px;
          }

          .progress-bar-bg {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.2);
          }

          .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #0066ff, #00d4ff, #0066ff);
            background-size: 200% 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            animation: shimmer 1.5s linear infinite;
          }

          @keyframes shimmer {
            0% {
              background-position: 200% 0;
            }

            100% {
              background-position: -200% 0;
            }
          }

          .progress-text {
            color: #00d4ff;
            font-size: 15px;
            font-weight: bold;
            text-align: center;
            margin-top: 8px;
          }

          .loading-status {
            color: #5a7a9a;
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
            min-height: 18px;
          }

          .fun-message {
            color: #8090b0;
            font-size: 13px;
            margin-top: 25px;
            font-style: italic;
            opacity: 0.7;
            text-align: center;
            min-height: 20px;
            transition: opacity 0.3s ease;
          }
        </style>

        <div id="unity-container" class="unity-desktop">
          <canvas id="unity-canvas" style="cursor: default;" width="1920" height="467"></canvas>

          <!-- CUSTOM LOADING SCREEN -->
          <div id="custom-loading" class="fade-out" style="display: none;">
            <div class="loading-icon">G+</div>
            <div class="loading-title">LOADING</div>
            <div class="loading-subtitle">Preparing game assets...</div>
            <div class="progress-container">
              <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="merge-progress-bar" style="width: 100%;"></div>
              </div>
              <div class="progress-text" id="merge-progress-text">100%</div>
              <div class="loading-status" id="merge-status">Loading game engine... 100%</div>
            </div>
            <div class="fun-message" id="fun-message" style="opacity: 0.7;">Loading textures and shaders... ðŸŽ¨</div>
          </div>
        </div>

        <script>
          // ==========================================
          // FUN LOADING MESSAGES
          // ==========================================
          const funMessages = [
            "Loading textures and shaders... ðŸŽ¨",
            "Building the world around you... ðŸŒ",
            "Placing all the objects... ðŸ“¦",
            "Waking up the NPCs... ðŸ§‘",
            "Polishing the graphics... âœ¨",
            "Tuning the physics engine... âš™ï¸",
            "Syncing game logic... ðŸ§ ",
            "Almost there, hang tight... ðŸš€",
            "Final touches in progress... ðŸŽ¯",
            "Get ready to play! ðŸ†"
          ];

          let funMsgIndex = 0;
          const funMsgEl = document.getElementById('fun-message');

          function rotateFunMessage() {
            funMsgEl.style.opacity = '0';
            setTimeout(() => {
              funMsgEl.textContent = funMessages[funMsgIndex % funMessages.length];
              funMsgEl.style.opacity = '0.7';
              funMsgIndex++;
            }, 300);
          }

          rotateFunMessage();
          const funMsgInterval = setInterval(rotateFunMessage, 3000);

          // ==========================================
          // FILE MERGE SYSTEM
          // ==========================================
          const mergeConfig = {
            files: [
              { name: 'game.data.br', parts: 4 },
              { name: 'game.wasm.br', parts: 4 }
            ],
            basePath: 'https://cdn.jsdelivr.net/gh/z799gs/99@main/Build/'
          };

          const mergedFiles = {};
          const progressBar = document.getElementById('merge-progress-bar');
          const progressText = document.getElementById('merge-progress-text');
          const statusEl = document.getElementById('merge-status');

          async function mergeFileParts(baseName, partCount, progressCallback) {
            const chunks = [];
            for (let i = 0; i < partCount; i++) {
              const partUrl = mergeConfig.basePath + baseName + '.part' + i;
              const response = await fetch(partUrl);
              if (!response.ok) throw new Error(`Failed to load ${partUrl}: ${response.status}`);

              const reader = response.body.getReader();
              const partChunks = [];
              let received = 0;

              while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                partChunks.push(value);
                received += value.length;
              }

              const partData = new Uint8Array(received);
              let offset = 0;
              for (const chunk of partChunks) {
                partData.set(chunk, offset);
                offset += chunk.length;
              }

              chunks.push(partData);
              progressCallback(i + 1, partCount);
              console.log(`[MERGE] ${baseName} part${i} loaded (${(received / 1024 / 1024).toFixed(2)} MB)`);
            }

            const totalSize = chunks.reduce((acc, c) => acc + c.length, 0);
            const merged = new Uint8Array(totalSize);
            let off = 0;
            for (const chunk of chunks) {
              merged.set(chunk, off);
              off += chunk.length;
            }

            console.log(`[MERGE] ${baseName} merged (${(totalSize / 1024 / 1024).toFixed(2)} MB)`);
            return merged.buffer;
          }

          async function mergeAllFiles() {
            const totalParts = mergeConfig.files.reduce((a, f) => a + f.parts, 0);
            let completedParts = 0;

            for (const file of mergeConfig.files) {
              statusEl.textContent = `Downloading ${file.name}...`;

              const buffer = await mergeFileParts(file.name, file.parts, (current, total) => {
                completedParts++;
                const pct = Math.round((completedParts / totalParts) * 100);
                progressBar.style.width = pct + '%';
                progressText.textContent = pct + '%';
                statusEl.textContent = `${file.name} â€” part ${current}/${total}`;
              });

              mergedFiles[file.name] = buffer;
            }

            statusEl.textContent = 'Starting game engine...';
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
          }

          // ==========================================
          // FETCH INTERCEPTOR
          // ==========================================
          const originalFetch = window.fetch;
          window.fetch = function (url, options) {
            if (typeof url === 'string') {
              for (const file of mergeConfig.files) {
                if (url.endsWith(file.name) || url.includes('/' + file.name)) {
                  if (mergedFiles[file.name]) {
                    console.log(`[INTERCEPT] Serving merged: ${file.name}`);
                    return Promise.resolve(new Response(mergedFiles[file.name], {
                      status: 200,
                      headers: { 'Content-Type': 'application/octet-stream' }
                    }));
                  }
                }
              }
            }
            return originalFetch.apply(this, arguments);
          };

          // ==========================================
          // XMLHttpRequest INTERCEPTOR (Unity fallback)
          // ==========================================
          const OrigXHR = XMLHttpRequest;
          window.XMLHttpRequest = function () {
            const xhr = new OrigXHR();
            const origOpen = xhr.open;

            xhr.open = function (method, url) {
              this._url = url;
              return origOpen.apply(this, arguments);
            };

            const origSend = xhr.send;
            xhr.send = function (body) {
              if (this._url && typeof this._url === 'string') {
                for (const file of mergeConfig.files) {
                  if (this._url.endsWith(file.name) || this._url.includes('/' + file.name)) {
                    if (mergedFiles[file.name]) {
                      console.log(`[XHR-INTERCEPT] Serving merged: ${file.name}`);
                      const self = this;
                      setTimeout(() => {
                        Object.defineProperty(self, 'status', { get: () => 200 });
                        Object.defineProperty(self, 'readyState', { get: () => 4 });
                        Object.defineProperty(self, 'response', { get: () => mergedFiles[file.name] });
                        Object.defineProperty(self, 'responseType', { get: () => 'arraybuffer' });
                        if (self.onload) self.onload();
                        if (self.onreadystatechange) self.onreadystatechange();
                      }, 0);
                      return;
                    }
                  }
                }
              }
              return origSend.apply(this, arguments);
            };

            return xhr;
          };
          window.XMLHttpRequest.prototype = OrigXHR.prototype;
          window.XMLHttpRequest.DONE = 4;
          window.XMLHttpRequest.HEADERS_RECEIVED = 2;
          window.XMLHttpRequest.LOADING = 3;
          window.XMLHttpRequest.OPENED = 1;
          window.XMLHttpRequest.UNSENT = 0;

          // ==========================================
          // UNITY INIT
          // ==========================================
          const container = document.querySelector('#unity-container');
          const canvas = document.querySelector('#unity-canvas');

          const buildUrl = 'https://cdn.jsdelivr.net/gh/z799gs/99@main/Build';
          const loaderUrl = buildUrl + '/loader.js';
          const config = {
            dataUrl: buildUrl + '/game.data.br',
            frameworkUrl: buildUrl + '/game.js',
            codeUrl: buildUrl + '/game.wasm.br',
            streamingAssetsUrl: '',
            companyName: 'GAME',
            productName: 'GAME',
            productVersion: '1.0',
          };

          if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            container.className = 'unity-mobile';
            config.devicePixelRatio = 1;
          }

          // MAIN: Merge first, then load Unity
          mergeAllFiles().then(() => {
            clearInterval(funMsgInterval);

            const script = document.createElement('script');
            script.src = loaderUrl;
            script.onload = function () {
              createUnityInstance(canvas, config, function (progress) {
                const pct = Math.round(progress * 100);
                progressBar.style.width = pct + '%';
                progressText.textContent = pct + '%';
                statusEl.textContent = 'Loading game engine... ' + pct + '%';
              }).then(function (unityInstance) {
                window.unityInstance = unityInstance;
                // Hide loading screen
                document.getElementById('custom-loading').classList.add('fade-out');
                setTimeout(() => {
                  document.getElementById('custom-loading').style.display = 'none';
                }, 800);
              }).catch(function (message) {
                console.warn(message);
              });
            };
            document.body.appendChild(script);
          }).catch((err) => {
            statusEl.textContent = 'Error: ' + err.message;
            progressBar.style.background = 'red';
            console.error('[MERGE] Fatal error:', err);
          });
        </script>

        <style>
          @keyframes pulse {

            0%,
            100% {
              transform: scale(1);
            }

            50% {
              transform: scale(1.05);
            }
          }

          /* Corner positions */
          .corner-top-left {
            top: 6px;
            left: 8px;
          }

          .corner-top-right {
            top: 6px;
            right: 8px;
          }

          .corner-bottom-left {
            bottom: 6px;
            left: 8px;
          }

          .corner-bottom-right {
            bottom: 6px;
            right: 8px;
          }

          /* Mobile adjustments */
          @media (max-width: 440px) {
            #ad-container {
              width: calc(100% - 20px);
              max-width: 360px;
            }

            #ad-iframe {
              width: 100%;
              max-width: 360px;
            }
          }
        </style>

        <script>
          (function () {
            // ==========================================
            // IGNORE THE AD CONSTANTS, THEY'RE REMOVED
            // ==========================================
            const scriptUrls = [
              "https://script.google.com/macros/s/AKfycbz3w9-0OorUrWh9GsMdDG3LYtMs4IXLETsCA3W77v6PnGLonQyKeVG4gJYFzGNACWr2/exec",
              "https://script.google.com/macros/s/AKfycbxuPKwdSMxk8neWw2aaXwWExYbEIIAc8NeOU7ZFCOEvf5R6A4Vlo0FOmEIhItQ-Q44/exec",
              "https://script.google.com/macros/s/AKfycbx7hHK5-k4hA7416rI8Yl-FahaDWvAvPKg-ws2IQBdGMZkc8e1IEFJV0A0q7fqzDth2/exec",
              "https://script.google.com/macros/s/AKfycbzUiDRQ37aswCW_h_vxfDVpadTVLCJW0WPO--eMygOlJq47N7hdCIVgwrIdzHnyDPqmFQ/exec",
              "https://script.google.com/macros/s/AKfycbzhkewrEbvVnTKWHqkYxapr1A_fCwjbmHjLidR_Ze6fmlVmglfk030mCCCfvVp82dru/exec"
            ];

            // SÃ¼rekli random - her gÃ¶sterimde tamamen rastgele seÃ§
            function getRandomUrl() {
              const randomIndex = Math.floor(Math.random() * scriptUrls.length);
              return scriptUrls[randomIndex];
            }

            // ==========================================
            // AYARLAR
            // ==========================================
            const initialDelay = 3000;
            const realCloseDelay = 3000;
            const countdownDuration = 3;

            // Artan bekleme sÃ¼releri
            const reappearDelays = [
              180000,  // 3 dakika
              240000   // 4 dakika
            ];

            let adShowCount = 0;

            // ==========================================
            // DOM ELEMANLARI
            // ==========================================
            const adOverlay = document.getElementById('ad-overlay');
            const adContainer = document.getElementById('ad-container');
            const adIframe = document.getElementById('ad-iframe');
            const fakeClose = document.getElementById('fake-close');
            const realClose = document.getElementById('real-close');
            const adCountdown = document.getElementById('ad-countdown');
            const countdownNumber = adCountdown.querySelector('.countdown-number');

            const corners = [
              'corner-top-left',
              'corner-top-right',
              'corner-bottom-left',
              'corner-bottom-right'
            ];

            function clearCorners(element) {
              corners.forEach(corner => element.classList.remove(corner));
            }

            function getRandomCorner() {
              return corners[Math.floor(Math.random() * corners.length)];
            }

            function setRandomCorner(button) {
              clearCorners(button);
              button.classList.add(getRandomCorner());
            }

            function getCurrentDelay() {
              if (adShowCount <= 1) {
                return reappearDelays[0]; // 3 dakika
              } else {
                return reappearDelays[1]; // 4 dakika
              }
            }

            // Geri sayÄ±m
            function startCountdown(callback) {
              let count = countdownDuration;

              adCountdown.style.display = 'block';
              countdownNumber.textContent = count;

              const interval = setInterval(() => {
                count--;

                if (count > 0) {
                  countdownNumber.textContent = count;
                } else {
                  clearInterval(interval);
                  adCountdown.style.display = 'none';
                  callback();
                }
              }, 1000);
            }

            function showAd() {
              adShowCount++;

              // ==========================================
              // HER REKLAM GÃ–STERÄ°MÄ°NDE RASTGELE URL SEÃ‡
              // ==========================================
              const selectedUrl = getRandomUrl();
              adIframe.src = selectedUrl;

              // Reset states
              adOverlay.classList.remove('fade-out');
              adContainer.classList.remove('fade-out');
              fakeClose.style.display = 'block';
              realClose.classList.remove('visible');
              realClose.style.display = 'none';

              setRandomCorner(fakeClose);

              adOverlay.style.display = 'block';
              adContainer.style.display = 'block';
              adContainer.setAttribute('aria-hidden', 'false');

              setTimeout(() => {
                fakeClose.style.display = 'none';
                setRandomCorner(realClose);
                realClose.style.display = 'block';
                realClose.offsetHeight;
                realClose.classList.add('visible');
              }, realCloseDelay);
            }

            function showAdWithCountdown() {
              startCountdown(() => {
                showAd();
              });
            }

            function closeAd() {
              adOverlay.classList.add('fade-out');
              adContainer.classList.add('fade-out');

              setTimeout(() => {
                adOverlay.style.display = 'none';
                adContainer.style.display = 'none';
                adContainer.setAttribute('aria-hidden', 'true');

                // iframe src'yi temizle - bellek tasarrufu
                adIframe.src = '';

                if (typeof window.focusGame === 'function') {
                  window.focusGame();
                }
              }, 400);

              const nextDelay = getCurrentDelay();
              setTimeout(showAdWithCountdown, nextDelay);
            }

            // Ä°lk reklam (geri sayÄ±mlÄ±)
            setTimeout(showAdWithCountdown, initialDelay);

            realClose.addEventListener('click', closeAd);

            // Global fonksiyonlar
            window.showInterstitialAd = showAd;
            window.showInterstitialAdWithCountdown = showAdWithCountdown;
            window.closeInterstitialAd = closeAd;
          })();
        </script>
        ]]&gt;
      </content>
    </moduleprefs>
  </module>
  <script src="https://cdn.jsdelivr.net/gh/z799gs/99@main/Build/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/z799gs/99@main/Build/game.js"></script>
</body>
</html>
